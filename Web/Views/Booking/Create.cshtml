@using System.Globalization
@model Web.Models.CreateBookingVm
@{
    ViewData["Title"] = "Book: " + Model.ServiceName;
}

<h1>Book: @Model.ServiceName</h1>
<p>Duration: @Model.ServiceDurationMinutes min</p>

<hr />

<!-- Date picker that refreshes the page (GET) to show slots for that date -->
<form method="get" asp-action="Create" asp-controller="Booking" class="mb-3">
    <input type="hidden" name="serviceId" value="@Model.ServiceId" />
    <label for="date">Pick a date:</label>
    <input id="date" name="date" type="date"
            min="@DateOnly.FromDateTime(DateTime.Today).ToString("yyyy-MM-dd")"
            value="@Model.Date.ToString("yyyy-MM-dd")"
            class="form-control" style="max-width:240px;" />
    <button type="submit" class="btn btn-secondary mt-2">Refresh Times</button>
</form>

<h3>Available times for @Model.Date.ToString("MMMM d, yyyy")</h3>
@if (Model.TimeOptions.Count == 0)
{
    <p>No slots today. Try another date.</p>
}
else
{
    <form method="post" asp-action="Create" asp-controller="Booking" class="mt-3">
        @Html.AntiForgeryToken()
        <input type="hidden" name="ServiceId" value="@Model.ServiceId" />
        <input type="hidden" name="Date" value="@Model.Date.ToString("yyyy-MM-dd")" />

        <div asp-validation-summary="All" class="text-danger"></div>

        <div class="mb-3" style="max-width:300px;">
            <label for="time" class="form-label">Time</label>
            <select id="time" name="Time" class="form-select" required>
                <option value="">Select a time</option>
                @foreach (var t in Model.TimeOptions)
                {
                    var isSelected = (ViewBag.SelectedTime as string) == t;
                    var display = TimeOnly.ParseExact(t, "HH:mm", CultureInfo.InvariantCulture)
                                        .ToString("h:mm tt"); // 12-hour label

                    if (isSelected)
                    {
                        <option value="@t" selected>@display</option>
                    }
                    else
                    {
                        <option value="@t">@display</option>
                    }
                }
            </select>

        </div>

        <div class="mb-3" style="max-width:420px;">
            <label class="form-label">Your name</label>
            <input name="CustomerName" class="form-control" required maxlength="120" />
        </div>

        <div class="mb-3" style="max-width:420px;">
            <label class="form-label">Email</label>
            <input name="CustomerEmail" type="email" class="form-control" required maxlength="256" />
        </div>

        <div class="mb-3" style="max-width:420px;">
            <label class="form-label">Phone (optional)</label>
            <input name="CustomerPhone" class="form-control" />
        </div>

        <button class="btn btn-primary">Confirm booking</button>
    </form>
}
