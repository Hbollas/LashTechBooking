@model Web.Models.CreateBookingVm
@using System.Globalization
@{
    ViewData["Title"] = $"Book {Model.ServiceName}";
    var selectedTime = (string)(ViewBag.SelectedTime ?? "");
    string To12(string t)
    {
        return TimeOnly.TryParseExact(t, "HH:mm", CultureInfo.InvariantCulture, DateTimeStyles.None, out var tt)
            ? tt.ToString("h:mm tt")
            : t;
    }
}

<!-- Top band: title + date refresher -->
<section class="bg-stone/60 border-b border-black/5 py-8">
  <div class="max-w-6xl mx-auto px-6">
    <h1 class="font-display text-3xl md:text-4xl text-ink">Book: @Model.ServiceName</h1>
    <p class="text-mute mt-1">@Model.ServiceDurationMinutes min</p>

    <form asp-action="Create" method="get" class="mt-4 flex flex-wrap items-center gap-3">
      <input type="hidden" name="serviceId" value="@Model.ServiceId" />
      <label class="text-sm text-mute">Pick a date</label>
      <input  type="date"
             name="date" 
             value="@Model.Date.ToString("yyyy-MM-dd")"
             min="@DateOnly.FromDateTime(DateTime.Today).ToString("yyyy-MM-dd")"
             max="@DateOnly.FromDateTime(DateTime.Today.AddMonths(6)).ToString("yyyy-MM-dd")"
             class="rounded-xl border border-black/10 bg-white/90 px-4 py-2 text-ink focus:outline-none focus:ring-2 focus:ring-ink/20" />
      <button type="submit"
              class="inline-flex items-center rounded-full bg-ink text-white px-5 py-2 text-sm font-semibold hover:opacity-90">
        Check Availability
      </button>
    </form>
  </div>
</section>

<!-- Main grid: form + summary -->
<section class="py-12">
  <div class="max-w-6xl mx-auto px-6 grid lg:grid-cols-3 gap-8">

    <!-- Form card -->
    <div class="lg:col-span-2">
      <div class="bg-panel rounded-2xl p-6 shadow">
        <form asp-action="Create" method="post" class="space-y-6" autocomplete="off">
          @Html.AntiForgeryToken()
        <div asp-validation-summary="All" class="alert alert-warning mb-3"></div>

          <input type="hidden" name="ServiceId" value="@Model.ServiceId" />
          <input type="hidden" name="Date" value="@Model.Date.ToString("yyyy-MM-dd")" />

          <div>
            <label class="block text-sm font-semibold text-ink mb-1">Time</label>
            <select name="Time"
                    class="w-full rounded-xl border border-black/10 bg-white/90 px-4 py-2 text-ink focus:outline-none focus:ring-2 focus:ring-ink/20">
              <option value="">Select a time</option>
              @foreach (var t in Model.TimeOptions)
              {
                  <option value="@t" selected="@(selectedTime == t ? "selected" : null)">@To12(t)</option>
              }
            </select>
          </div>

          <div class="grid sm:grid-cols-2 gap-4">
            <div>
              <label for="CustomerName" class="block text-sm font-semibold text-ink mb-1">Your name</label>
              <input id="CustomerName" name="CustomerName" autocomplete="off" required
                     class="w-full rounded-xl border border-black/10 bg-white/90 px-4 py-2 text-ink focus:outline-none focus:ring-2 focus:ring-ink/20" />
            </div>
            <div>
              <label for="CustomerEmail" class="block text-sm font-semibold text-ink mb-1">Email</label>
              <input id="CustomerEmail" name="CustomerEmail" type="email" autocomplete="off" required
                     class="w-full rounded-xl border border-black/10 bg-white/90 px-4 py-2 text-ink focus:outline-none focus:ring-2 focus:ring-ink/20" />
            </div>
            <div class="sm:col-span-2">
            <label for="CustomerPhone" class="block text-sm font-semibold text-ink mb-1">
                Phone (optional)
            </label>

            <input
                type="tel"
                name="CustomerPhone"
                id="CustomerPhone"
                inputmode="tel"
                autocomplete="off"
                placeholder="(555) 555-1234"
                pattern="^(\+?1[-.\s]?)?(\(?\d{3}\)?[-.\s]?)\d{3}[-.\s]?\d{4}$"
                class="w-full rounded-xl border border-black/10 bg-white/90 px-4 py-2 text-ink focus:outline-none focus:ring-2 focus:ring-ink/20" />

            @Html.ValidationMessage("CustomerPhone", new { @class = "text-danger" })
            </div>

          </div>

          <div class="pt-2">
            <button type="submit"
                    class="inline-flex items-center rounded-full bg-ink text-white px-6 py-2.5 text-sm font-semibold hover:opacity-90">
              Confirm booking
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Sticky summary card -->
    <aside>
      <div class="bg-white rounded-2xl p-6 shadow border border-black/5 lg:sticky lg:top-24">
        <h3 class="font-serif text-2xl text-ink leading-tight">Appointment summary</h3>
        <dl class="mt-3 text-sm text-ink/90">
          <div class="flex justify-between py-2 border-b border-black/5">
            <dt>Service</dt><dd>@Model.ServiceName</dd>
          </div>
          <div class="flex justify-between py-2 border-b border-black/5">
            <dt>Date</dt><dd>@Model.Date.ToString("dddd, MMM d, yyyy")</dd>
          </div>
          <div class="flex justify-between py-2">
            <dt>Duration</dt><dd>@Model.ServiceDurationMinutes min</dd>
          </div>
        </dl>
        <p class="text-xs text-mute mt-4">Youâ€™ll receive an email confirmation after booking.</p>
      </div>
    </aside>

  </div>
</section>

@section Scripts {
  <partial name="_ValidationScriptsPartial" />
}
