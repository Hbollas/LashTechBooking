@model IEnumerable<Web.Controllers.AdminController.AdminApptRow>
@{
    ViewData["Title"] = "Admin • Appointments";
}

<h1>Appointments</h1>

@if (TempData["Message"] is string msg)
{
    <div class="alert alert-success">@msg</div>
}

<table class="table table-striped">
  <thead>
    <tr>
      <th>Date</th>
      <th>Time</th>
      <th>Service</th>
      <th>Customer</th>
      <th>Email</th>
      <th>Status</th>
      <th>Deposit</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
  @foreach (var item in Model)
  {
      var startLocal = item.StartUtc.ToLocalTime();
      var endLocal   = item.EndUtc.ToLocalTime();
      <tr>
        <td>@startLocal.ToString("ddd, MMM d")</td>
        <td>@startLocal.ToString("h:mm tt") – @endLocal.ToString("h:mm tt")</td>
        <td>@item.Service</td>
        <td>@item.Customer</td>
        <td>@item.Email</td>
        <td>@item.Status</td>
        <td>@(item.DepositPaid ? "Yes" : "No")</td>
        <td class="text-end">
          @if (item.Status == "Cancelled")
          {
              <span class="text-muted">Cancelled</span>
          }
          else
          {
              <form asp-action="Cancel" asp-controller="Admin" method="post" class="d-inline">
                  @Html.AntiForgeryToken()
                  <input type="hidden" name="id" value="@item.Id" />
                  <button class="btn btn-sm btn-outline-danger"
                          onclick="return confirm('Cancel this appointment?');">
                      Cancel
                  </button>
              </form>
          }
        </td>
      </tr>
  }
  </tbody>
</table>
